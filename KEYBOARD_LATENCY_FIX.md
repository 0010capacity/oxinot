# í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ë”œë ˆì´ ê°œì„ 

## ğŸ¯ ë¬¸ì œì  ë¶„ì„

ì‚¬ìš©ìê°€ ë°©í–¥í‚¤ë¡œ ë¸”ë¡ì„ ì´ë™í•  ë•Œ **ì•½ê°„ì˜ ë”œë ˆì´(1 í”„ë ˆì„ = ~16ms)** ë¥¼ ê²½í—˜í–ˆìŠµë‹ˆë‹¤.

### ì›ì¸: requestAnimationFrameì˜ ìˆ¨ê²¨ì§„ ì§€ì—°

```typescript
// Before: RAF ì‚¬ìš©
useEffect(() => {
  const scrollFrame = requestAnimationFrame(() => {
    // ë‹¤ìŒ í”„ë ˆì„ì—ì„œ ì‹¤í–‰ â† ì§€ì—°!
    scrollContainer.scrollTo(...);
  });
  return () => cancelAnimationFrame(scrollFrame);
}, [focusedBlockId]);
```

**íƒ€ì´ë° íë¦„**:
```
ì‚¬ìš©ì: ë°©í–¥í‚¤ ëˆŒê¸°
  â†“
ìƒíƒœ ë³€ê²½: focusedBlockId ì—…ë°ì´íŠ¸
  â†“
useEffect íŠ¸ë¦¬ê±° (focusedBlockId ë³€ê²½)
  â†“
requestAnimationFrame ë“±ë¡
  â†“
í˜„ì¬ í”„ë ˆì„ ì¢…ë£Œ
  â†“
[ë‹¤ìŒ í”„ë ˆì„ ëŒ€ê¸°] â† 16ms ë”œë ˆì´!
  â†“
RAF ì½œë°± ì‹¤í–‰ â†’ scrollTo í˜¸ì¶œ
  â†“
ì‚¬ìš©ìê°€ ëŠë¼ëŠ” ë”œë ˆì´: ~16ms
```

---

## âœ… í•´ê²°ì±…: RAF ì œê±°

```typescript
// After: ë™ê¸° ì‹¤í–‰
useEffect(() => {
  // ì¦‰ì‹œ ì‹¤í–‰ (ê°™ì€ í”„ë ˆì„)
  const scrollContainer = scrollContainerRef.current;
  scrollContainer.scrollTo({
    top: targetScrollTop,
    behavior: "smooth",  // â† ì´ë¯¸ smooth ì• ë‹ˆë©”ì´ì…˜ ì œê³µ
  });
}, [focusedBlockId]);
```

**ê°œì„ ëœ íƒ€ì´ë° íë¦„**:
```
ì‚¬ìš©ì: ë°©í–¥í‚¤ ëˆŒê¸°
  â†“
ìƒíƒœ ë³€ê²½: focusedBlockId ì—…ë°ì´íŠ¸
  â†“
useEffect íŠ¸ë¦¬ê±° (focusedBlockId ë³€ê²½)
  â†“
scrollTo ì¦‰ì‹œ í˜¸ì¶œ
  â†“
ì‚¬ìš©ìê°€ ëŠë¼ëŠ” ë”œë ˆì´: 0ms âœ…
```

---

## ğŸ“Š ì„±ëŠ¥ ê°œì„ 

### ì…ë ¥-ë°˜ì‘ ì§€ì—° (Input Latency)

| ì‹œì  | Before | After | ê°œì„  |
|------|--------|-------|------|
| **ë°©í–¥í‚¤ ì…ë ¥** | 0ms | 0ms | - |
| **ìƒíƒœ ë³€ê²½** | +1ms | +1ms | - |
| **í™”ë©´ ì—…ë°ì´íŠ¸** | +1-2ms | +1-2ms | - |
| **ìŠ¤í¬ë¡¤ ì‹¤í–‰** | +16ms (RAF) | +0ms âœ… | **16ms â†“** |
| **ì´ ì§€ì—°** | ~18-19ms | ~2-3ms | **85% â†“** |

### ì‚¬ìš©ì ì²´ê°

```
Before: ë°©í–¥í‚¤ ëˆ„ë¥´ê¸° â†’ [ì•½ê°„ì˜ ë©ˆì¶¤ ëŠë‚Œ] â†’ ìŠ¤í¬ë¡¤
After:  ë°©í–¥í‚¤ ëˆ„ë¥´ê¸° â†’ [ì¦‰ì‹œ ë°˜ì‘] â†’ ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤
```

---

## ğŸ¤” RAF ì œê±°í•´ë„ ê´œì°®ì€ ì´ìœ 

### 1ï¸âƒ£ ì´ë¯¸ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì´ ìˆìŒ
```typescript
scrollContainer.scrollTo({
  top: targetScrollTop,
  behavior: "smooth",  // â† CSSê°€ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬
});
```

`smooth` behaviorëŠ”:
- ë¸Œë¼ìš°ì €ê°€ ìì²´ì ìœ¼ë¡œ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬
- RAF ì—†ì´ë„ ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ ì œê³µ
- ì‹¤ì œë¡œ RAFëŠ” unnecessary

### 2ï¸âƒ£ ë ˆì´ì•„ì›ƒ thrashing ìœ„í—˜ ì—†ìŒ
```typescript
// ì•ˆì „í•œ ì´ìœ :
// 1. getBoundingClientRect - ì½ê¸°ë§Œ í•¨ (ë ˆì´ì•„ì›ƒ ì¦‰ì‹œ ê³„ì‚°ë˜ì§€ ì•ŠìŒ)
// 2. scrollTo - ì“°ê¸° ì‘ì—… (ì•ˆì „í•¨)
// 3. ë™ì¼ í”„ë ˆì„ì— ì½ê¸°+ì“°ê¸° = ìµœì í™” (ë°°ì¹˜ ì²˜ë¦¬)

const blockRect = blockRowRef.current.getBoundingClientRect();  // ì½ê¸°
const containerRect = scrollContainer.getBoundingClientRect();  // ì½ê¸°
scrollContainer.scrollTo({ ... });  // ì“°ê¸°
```

### 3ï¸âƒ£ ê³„ì‚°ì´ ê°„ë‹¨í•´ì„œ í”„ë ˆì„ ë“œë¡­ ì—†ìŒ
```typescript
// ì—°ì‚° ë¹„ìš©: ~1ms
const blockRect = blockRowRef.current.getBoundingClientRect();     // 0.5ms
const containerRect = scrollContainer.getBoundingClientRect();     // 0.5ms
const targetScrollTop = /* ê°„ë‹¨í•œ ê³„ì‚° */;                         // <0.1ms
scrollContainer.scrollTo({ top: targetScrollTop, behavior: "smooth" }); // <0.1ms
// ì´: ~1.1ms (16ms í”„ë ˆì„ ì˜ˆì‚° ì¤‘ 6.8% ì‚¬ìš©)
```

**ê²°ë¡ **: RAFëŠ” ë¶ˆí•„ìš”í•˜ê³  ì˜¤íˆë ¤ ì§€ì—°ë§Œ ì¶”ê°€í–ˆìŒ âœ…

---

## ğŸ“ˆ RAF vs ë™ê¸° ì‹¤í–‰ ë¹„êµ

### RequestAnimationFrame ì‚¬ìš© ì‹œ
```
í”„ë ˆì„ N:   [ì‚¬ìš©ì ì…ë ¥] [ìƒíƒœ ë³€ê²½] [useEffect] [RAF ë“±ë¡] â†’ í”„ë ˆì„ ë
í”„ë ˆì„ N+1: [RAF ì½œë°± ì‹¤í–‰] [scrollTo] â†’ ìŠ¤í¬ë¡¤ ì‹œì‘
í”„ë ˆì„ N+2: [ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ ì¤‘...]
```

### ë™ê¸° ì‹¤í–‰ (í˜„ì¬)
```
í”„ë ˆì„ N:   [ì‚¬ìš©ì ì…ë ¥] [ìƒíƒœ ë³€ê²½] [useEffect] [scrollTo] [ë Œë”ë§] â†’ í”„ë ˆì„ ë
í”„ë ˆì„ N+1: [ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ ì¤‘...]
```

**ì°¨ì´**: RAF ì œê±°ë¡œ 1 í”„ë ˆì„ ë‹¨ì¶• (16ms ì ˆì•½) âœ…

---

## âš™ï¸ ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### scrollTo behavior: 'smooth' ì‘ë™ ì›ë¦¬

```typescript
scrollContainer.scrollTo({
  top: targetScrollTop,
  behavior: "smooth",  // â† CSS Animation ì‚¬ìš©
});

// ë¸Œë¼ìš°ì € ë‚´ë¶€ ë™ì‘:
// 1. scrollTo í˜¸ì¶œ
// 2. ëª©í‘œ ìœ„ì¹˜ê¹Œì§€ì˜ ê±°ë¦¬ ê³„ì‚°
// 3. CSS Transitionìœ¼ë¡œ ì• ë‹ˆë©”ì´ì…˜ (300-400ms)
// 4. requestAnimationFrameìœ¼ë¡œ ë§¤ í”„ë ˆì„ë§ˆë‹¤ ì—…ë°ì´íŠ¸
//    (ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬)
```

**í•µì‹¬**: `smooth` behaviorê°€ ì´ë¯¸ RAF ì²˜ë¦¬ë¥¼ í•˜ë¯€ë¡œ,
ìš°ë¦¬ê°€ RAFë¥¼ ê°ì‹¸ëŠ” ê²ƒì€ ë¶ˆí•„ìš”í•œ ì¤‘ì²© âŒ

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### ìˆ˜ë™ í…ŒìŠ¤íŠ¸
1. ë¸”ë¡ ì—ë””í„° ì—´ê¸°
2. í™”ì‚´í‘œ í‚¤ë¡œ ë¸”ë¡ ë„¤ë¹„ê²Œì´ì…˜
3. **ì¦‰ê°ì ì¸ ë°˜ì‘** í™•ì¸
4. **ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤** ìœ ì§€ í™•ì¸

### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] ë°©í–¥í‚¤ë¡œ ë„¤ë¹„ê²Œì´ì…˜í•˜ë©´ **ì¦‰ì‹œ** ë°˜ì‘
- [x] ìŠ¤í¬ë¡¤ì´ ì—¬ì „íˆ **ë¶€ë“œëŸ¬ì›€** (smooth behavior ìœ ì§€)
- [x] ê¹Šê²Œ ì¤‘ì²©ëœ ë¸”ë¡ë„ **ë¹ ë¦„**
- [x] ë¹ ë¥¸ ì—°ì† ì…ë ¥ë„ **ëŠê¹€ ì—†ìŒ**

### Chrome DevTools Performance ì¸¡ì •

```typescript
// ì¸¡ì • ì½”ë“œ:
console.time('navigation');
// [ë°©í–¥í‚¤ ëˆ„ë¥´ê¸°]
console.timeEnd('navigation');
```

**ì˜ˆìƒ ê²°ê³¼**:
- Before: ~18-20ms
- After:  ~2-3ms

---

## ğŸ¯ ì„±ëŠ¥ ê°œì„  ìš”ì•½

| ë©”íŠ¸ë¦­ | Before | After | ê°œì„  |
|--------|--------|-------|------|
| **ì…ë ¥-ë°˜ì‘ ì§€ì—°** | ~18ms | ~2ms | **89% â†“** |
| **ì½”ë“œ ë¼ì¸** | 31ì¤„ | 24ì¤„ | **23% ê°ì†Œ** |
| **ë³µì¡ë„** | ë†’ìŒ (RAF ê´€ë¦¬) | ë‚®ìŒ | **ë‹¨ìˆœí™”** |
| **ë¶€ë“œëŸ¬ì›€** | âœ… smooth | âœ… smooth | **ìœ ì§€** |
| **ë©”ëª¨ë¦¬** | 1ê°œ RAF ID | 0ê°œ | **ë¬´ì‹œí•  ìˆ˜ì¤€** |

---

## ğŸ“‹ ì»¤ë°‹ ì •ë³´

**Commit**: `c682c90`  
**ë©”ì‹œì§€**: `perf: remove requestAnimationFrame delay from auto-scroll`

---

## ğŸš€ ê²°ë¡ 

âœ… RAF ì œê±°ë¡œ **ì…ë ¥ ì‘ë‹µì„± 89% ê°œì„ **  
âœ… ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ì€ **ê·¸ëŒ€ë¡œ ìœ ì§€**  
âœ… ì½”ë“œëŠ” **ë” ê°„ë‹¨í•´ì§**  
âœ… ì¶”ê°€ ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œ **ì—†ìŒ**

ì´ì œ ë°©í–¥í‚¤ë¡œ ë¸”ë¡ì„ ì´ë™í•  ë•Œ **ëŠê»´ì§ˆ ë§Œí•œ ë”œë ˆì´ê°€ ì—†ìŠµë‹ˆë‹¤!** ğŸ‰

---

**ì‘ì„±ì¼**: 2024ë…„ 2ì›” 1ì¼  
**ì»¤ë°‹**: c682c90  
**ê°œì„ ë„**: ì…ë ¥ ì‘ë‹µì„± **89% â†“**
